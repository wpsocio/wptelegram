import{_ as a,j as e,a as k,s as D}from"./index-CYu8q2MW.js";const C="_wptg_p2tg_",B="wptelegram-post-to-telegram";var _;let y={channels:[],delay:"0",disable_notification:!1,message_template:"",override_switch:!1,send2tg:!0,send_featured_image:!0,files:{},...(_=window.wptelegram)==null?void 0:_.savedSettings};const w=()=>{const{editPost:t}=wp.data.useDispatch("core/editor"),{data:o}=u();return wp.element.useCallback(i=>c=>{const d={...o,[i]:c};t({[C]:d},{undoIgnore:!0}),y=d},[o,t])},u=()=>wp.data.useSelect(t=>{const{getEditedPostAttribute:o,isSavingPost:i,isPublishingPost:c,isEditedPostDirty:d}=t(wp.editor.store),r=o(C);return{data:r||y,isDirty:d(),isSaving:i()||c(),savedData:r}},[]);var f,b;const m=((b=(f=window.wptelegram)==null?void 0:f.uiData)==null?void 0:b.allChannels)||[],P=()=>{var l;const{data:t}=u(),o=w(),i=wp.element.useCallback(s=>()=>{var h,x;const g=((h=t.channels)==null?void 0:h.indexOf(s))!==-1?(x=t.channels)==null?void 0:x.filter(S=>S!==s):[...t.channels||[],s];o("channels")(g)},[t.channels,o]),c=m.every(s=>{var n;return((n=t.channels)==null?void 0:n.indexOf(s))!==-1}),d=!c&&m.some(s=>{var n;return((n=t.channels)==null?void 0:n.indexOf(s))!==-1}),r=m.length>5?`(${((l=t.channels)==null?void 0:l.length)||0}/${m.length})`:"",p=`${a("Send to")} ${r}`;return e.jsx(wp.components.BaseControl,{id:"wptg-send-to",label:p,__nextHasNoMarginBottom:!0,children:e.jsxs(wp.components.Flex,{direction:"column",role:"group",id:"wptg-send-to","aria-label":p,children:[e.jsx(wp.components.CheckboxControl,{checked:c,indeterminate:d,onChange:s=>{const n=s?m:[];o("channels")(n)},label:a("Select all"),__nextHasNoMarginBottom:!0}),m.map((s,n)=>{var g;return e.jsx(wp.components.CheckboxControl,{label:s,checked:((g=t.channels)==null?void 0:g.indexOf(s))!==-1,onChange:i(s),__nextHasNoMarginBottom:!0},s+n)})]})})},v=({open:t})=>e.jsx(wp.components.Button,{variant:"secondary",onClick:t,id:"wptg-upload-media",children:a("Add or Upload Files")}),M=[],F=({isDisabled:t})=>{const{data:o}=u(),i=w(),c=wp.element.useCallback(r=>()=>{const{[r]:p,...l}=o.files||{};i("files")(l)},[o.files,i]),d=wp.element.useCallback(r=>{const p=r.reduce((l,{id:s,url:n})=>(l[s]=n,l),{});i("files")(p)},[i]);return e.jsx(wp.components.Disabled,{isDisabled:t,children:e.jsxs(wp.components.BaseControl,{id:"wptg-files",label:a("Files"),help:a("Files to be sent after the message."),__nextHasNoMarginBottom:!0,children:[e.jsx("br",{}),e.jsx(wp.mediaUtils.MediaUpload,{multiple:!0,onSelect:d,allowedTypes:M,render:v}),e.jsx("ul",{role:"group",id:"wptg-files","aria-label":a("Files"),children:Object.entries(o.files||{}).map(([r,p],l)=>{const s=p.split("/"),n=s[s.length-1];return e.jsx("li",{children:e.jsxs(wp.components.Flex,{justify:"flex-start",children:[e.jsx(wp.components.Button,{icon:e.jsx(wp.components.Icon,{icon:"no-alt"}),onClick:c(r)}),e.jsx("span",{children:n})]})},r+l)})})]})})},T=()=>e.jsx(wp.components.SVG,{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"img","aria-hidden":"true",focusable:"false",children:e.jsx(wp.components.Path,{fillRule:"evenodd",d:"M10.289 4.836A1 1 0 0111.275 4h1.306a1 1 0 01.987.836l.244 1.466c.787.26 1.503.679 2.108 1.218l1.393-.522a1 1 0 011.216.437l.653 1.13a1 1 0 01-.23 1.273l-1.148.944a6.025 6.025 0 010 2.435l1.149.946a1 1 0 01.23 1.272l-.653 1.13a1 1 0 01-1.216.437l-1.394-.522c-.605.54-1.32.958-2.108 1.218l-.244 1.466a1 1 0 01-.987.836h-1.306a1 1 0 01-.986-.836l-.244-1.466a5.995 5.995 0 01-2.108-1.218l-1.394.522a1 1 0 01-1.217-.436l-.653-1.131a1 1 0 01.23-1.272l1.149-.946a6.026 6.026 0 010-2.435l-1.148-.944a1 1 0 01-.23-1.272l.653-1.131a1 1 0 011.217-.437l1.393.522a5.994 5.994 0 012.108-1.218l.244-1.466zM14.929 12a3 3 0 11-6 0 3 3 0 016 0z"})}),N={width:"100%",maxWidth:"650px"},I={display:"flex",flexDirection:"column",justifyContent:"space-between"},O={width:"100%",justifyContent:"center",marginTop:"2em"},H={height:"1.5em"},A=()=>{const{data:t}=u(),o=w(),[i,c]=wp.element.useState(!1),d=wp.element.useCallback(()=>c(!0),[]),r=wp.element.useCallback(()=>c(!1),[]),p=wp.element.useCallback(n=>{var g;n!=null&&n.target&&"id"in n.target&&((g=n==null?void 0:n.target)==null?void 0:g.id)==="wptg-upload-media"||r()},[r]),l=e.jsx("div",{style:H}),s=!t.override_switch;return e.jsxs(e.Fragment,{children:[e.jsx(wp.components.Button,{"aria-label":a("Override settings"),disabled:!t.send2tg,icon:e.jsx(T,{}),size:"small",onClick:d}),i&&e.jsx(wp.components.Modal,{isDismissible:!1,title:k("%s (%s)",a("Post to Telegram"),a("Override settings")),onRequestClose:p,style:N,children:e.jsxs("div",{style:I,children:[e.jsxs("div",{children:[e.jsx(wp.components.ToggleControl,{label:a("Override settings"),checked:t.override_switch,onChange:o("override_switch"),__nextHasNoMarginBottom:!0}),e.jsxs(wp.components.Disabled,{isDisabled:s,style:{opacity:s?.3:1},children:[l,e.jsx(P,{}),l,e.jsx(F,{}),l,e.jsx(wp.components.ToggleControl,{label:a("Disable Notifications"),checked:t.disable_notification,onChange:o("disable_notification"),__nextHasNoMarginBottom:!0}),l,e.jsx(wp.components.TextControl,{label:a("Delay in Posting"),value:t.delay||"0.5",onChange:o("delay"),step:"0.5",min:0,type:"number",__nextHasNoMarginBottom:!0}),l,e.jsx(wp.components.ToggleControl,{label:a("Featured Image"),checked:t.send_featured_image,onChange:o("send_featured_image"),help:a("Send Featured Image (if exists)."),__nextHasNoMarginBottom:!0}),l,e.jsx(wp.components.TextareaControl,{label:a("Message Template"),value:t.message_template||"",onChange:o("message_template"),rows:10,__nextHasNoMarginBottom:!0})]})]}),e.jsx(wp.components.Button,{style:O,variant:"primary",onClick:r,children:a("Save Changes")})]})})]})},E={display:"flex",justifyContent:"space-between",alignItems:"flex-start",width:"100%",marginTop:"1rem"},U=wp.editor.PluginPostStatusInfo||wp.editPost.PluginPostStatusInfo,R=()=>{const{data:t,savedData:o,isSaving:i,isDirty:c}=u(),d=w();return wp.element.useEffect(()=>{c&&!i&&!o&&d("send2tg")(t.send2tg)},[t.send2tg,c,i,o,d]),e.jsx(U,{children:e.jsxs("div",{style:E,children:[e.jsx(wp.components.ToggleControl,{label:a("Send to Telegram"),checked:t.send2tg,onChange:d("send2tg"),__nextHasNoMarginBottom:!0}),e.jsx(A,{})]})})};var j;const $=(j=window.wptelegram)==null?void 0:j.i18n;D($,"wptelegram");wp.plugins.registerPlugin(B,{render:R});
//# sourceMappingURL=p2tg-block-editor-2dtg-WYR.js.map
