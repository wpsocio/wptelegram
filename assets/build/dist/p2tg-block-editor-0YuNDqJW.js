import{_ as a,j as e,a as k,s as D}from"./index-D7Lh2MVf.js";const y="_wptg_p2tg_",F="wptelegram-post-to-telegram";var b;let v={channels:[],delay:"0",disable_notification:!1,message_template:"",override_switch:!1,send2tg:!0,send_featured_image:!0,files:{},...(b=window.wptelegram)==null?void 0:b.savedSettings};const u=()=>{const{editPost:t}=wp.data.useDispatch("core/editor"),{data:s}=m();return wp.element.useCallback(l=>c=>{const i={...s,[l]:c};t({[y]:i},{undoIgnore:!0}),v=i},[s,t])},m=()=>wp.data.useSelect(t=>{const{getEditedPostAttribute:s,isSavingPost:l,isPublishingPost:c,isEditedPostDirty:i}=t(wp.editor.store),r=s(y);return{data:r||v,isDirty:i(),isSaving:l()||c(),savedData:r}},[]);var C,j;const w=((j=(C=window.wptelegram)==null?void 0:C.uiData)==null?void 0:j.allChannels)||[],T=({isDisabled:t})=>{var d;const{data:s}=m(),l=u(),c=wp.element.useCallback(n=>()=>{var x,f;const h=((x=s.channels)==null?void 0:x.indexOf(n))!==-1?(f=s.channels)==null?void 0:f.filter(S=>S!==n):[...s.channels||[],n];l("channels")(h)},[s.channels,l]),i=w.every(n=>{var p;return((p=s.channels)==null?void 0:p.indexOf(n))!==-1}),r=!i&&w.some(n=>{var p;return((p=s.channels)==null?void 0:p.indexOf(n))!==-1}),g=w.length>5?`(${((d=s.channels)==null?void 0:d.length)||0}/${w.length})`:"",o=`${a("Send to")} ${g}`;return e.jsx(wp.components.BaseControl,{id:"wptg-send-to",label:o,children:e.jsxs("div",{role:"group",id:"wptg-send-to","aria-label":o,children:[e.jsx(wp.components.CheckboxControl,{checked:i,disabled:t,indeterminate:r,onChange:n=>{const p=n?w:[];l("channels")(p)},label:a("Select all")}),w.map((n,p)=>{var h;return e.jsx(wp.components.CheckboxControl,{label:n,disabled:t,checked:((h=s.channels)==null?void 0:h.indexOf(n))!==-1,onChange:c(n)},n+p)})]})})},P=({open:t})=>e.jsx(wp.components.Button,{variant:"secondary",onClick:t,id:"wptg-upload-media",children:a("Add or Upload Files")}),O=[],B=({isDisabled:t})=>{const{data:s}=m(),l=u(),c=wp.element.useCallback(r=>()=>{const{[r]:g,...o}=s.files||{};l("files")(o)},[s.files,l]),i=wp.element.useCallback(r=>{const g=r.reduce((o,{id:d,url:n})=>(o[d]=n,o),{});l("files")(g)},[l]);return e.jsx(wp.components.Disabled,{isDisabled:t,children:e.jsxs(wp.components.BaseControl,{id:"wptg-files",label:a("Files"),help:a("Files to be sent after the message."),children:[e.jsx("br",{}),e.jsx(wp.mediaUtils.MediaUpload,{multiple:!0,onSelect:i,allowedTypes:O,render:P}),e.jsx("ul",{role:"group",id:"wptg-files","aria-label":a("Files"),children:Object.entries(s.files||{}).map(([r,g],o)=>{const d=g.split("/"),n=d[d.length-1];return e.jsx("li",{children:e.jsxs(wp.components.Flex,{justify:"flex-start",children:[e.jsx(wp.components.Button,{icon:e.jsx(wp.components.Icon,{icon:"no-alt"}),onClick:c(r)}),e.jsx("span",{children:n})]})},r+o)})})]})})},I=()=>e.jsx(wp.components.SVG,{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"img","aria-hidden":"true",focusable:"false",children:e.jsx(wp.components.Path,{fillRule:"evenodd",d:"M10.289 4.836A1 1 0 0111.275 4h1.306a1 1 0 01.987.836l.244 1.466c.787.26 1.503.679 2.108 1.218l1.393-.522a1 1 0 011.216.437l.653 1.13a1 1 0 01-.23 1.273l-1.148.944a6.025 6.025 0 010 2.435l1.149.946a1 1 0 01.23 1.272l-.653 1.13a1 1 0 01-1.216.437l-1.394-.522c-.605.54-1.32.958-2.108 1.218l-.244 1.466a1 1 0 01-.987.836h-1.306a1 1 0 01-.986-.836l-.244-1.466a5.995 5.995 0 01-2.108-1.218l-1.394.522a1 1 0 01-1.217-.436l-.653-1.131a1 1 0 01.23-1.272l1.149-.946a6.026 6.026 0 010-2.435l-1.148-.944a1 1 0 01-.23-1.272l.653-1.131a1 1 0 011.217-.437l1.393.522a5.994 5.994 0 012.108-1.218l.244-1.466zM14.929 12a3 3 0 11-6 0 3 3 0 016 0z"})}),M={width:"100%",maxWidth:"650px"},A={display:"flex",flexDirection:"column",justifyContent:"space-between"},E={width:"100%",justifyContent:"center",marginTop:"2em"},U={height:"1.5em"},R=()=>{const{data:t}=m(),s=u(),[l,c]=wp.element.useState(!1),i=wp.element.useCallback(()=>c(!0),[]),r=wp.element.useCallback(()=>c(!1),[]),g=wp.element.useCallback(d=>{var n;d!=null&&d.target&&"id"in d.target&&((n=d==null?void 0:d.target)==null?void 0:n.id)==="wptg-upload-media"||r()},[r]),o=e.jsx("div",{style:U});return e.jsxs(e.Fragment,{children:[e.jsx(wp.components.Button,{"aria-label":a("Override settings"),disabled:!t.send2tg,icon:e.jsx(I,{}),size:"small",onClick:i}),l&&e.jsx(wp.components.Modal,{isDismissible:!1,title:k("%s (%s)",a("Post to Telegram"),a("Override settings")),onRequestClose:g,style:M,children:e.jsxs("div",{style:A,children:[e.jsxs("div",{children:[e.jsx(wp.components.ToggleControl,{label:a("Override settings"),checked:t.override_switch,onChange:s("override_switch")}),o,e.jsx(T,{isDisabled:!t.override_switch}),o,e.jsx(B,{isDisabled:!t.override_switch}),o,e.jsx(wp.components.ToggleControl,{disabled:!t.override_switch,label:a("Disable Notifications"),checked:t.disable_notification,onChange:s("disable_notification")}),o,e.jsx(wp.components.TextControl,{disabled:!t.override_switch,label:a("Delay in Posting"),value:t.delay||"0.5",onChange:s("delay"),step:"0.5",min:0,type:"number"}),o,e.jsx(wp.components.ToggleControl,{disabled:!t.override_switch,label:a("Featured Image"),checked:t.send_featured_image,onChange:s("send_featured_image"),help:a("Send Featured Image (if exists).")}),o,e.jsx(wp.components.TextareaControl,{disabled:!t.override_switch,label:a("Message Template"),value:t.message_template||"",onChange:s("message_template"),rows:10})]}),e.jsx(wp.components.Button,{style:E,variant:"primary",onClick:r,children:a("Save Changes")})]})})]})},$={display:"flex",justifyContent:"space-between",alignItems:"flex-start",width:"100%",marginTop:"1rem"},z=()=>{const{data:t,savedData:s,isSaving:l,isDirty:c}=m(),i=u();return wp.element.useEffect(()=>{c&&!l&&!s&&i("send2tg")(t.send2tg)},[t.send2tg,c,l,s,i]),e.jsx(wp.editPost.PluginPostStatusInfo,{children:e.jsxs("div",{style:$,children:[e.jsx(wp.components.ToggleControl,{label:a("Send to Telegram"),checked:t.send2tg,onChange:i("send2tg")}),e.jsx(R,{})]})})};var _;const G=(_=window.wptelegram)==null?void 0:_.i18n;D(G,"wptelegram");wp.plugins.registerPlugin(F,{render:z});
//# sourceMappingURL=p2tg-block-editor-0YuNDqJW.js.map
