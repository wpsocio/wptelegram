import{_ as a,a as J,s as X}from"./index-Di0ZVv46.js";const C="_wptg_p2tg_",y="wptelegram-post-to-telegram";var S;let j={channels:[],delay:"0",disable_notification:!1,message_template:"",override_switch:!1,send2tg:!0,send_featured_image:!0,files:{},...(S=window.wptelegram)==null?void 0:S.savedSettings};const w=()=>{const{editPost:e}=wp.data.useDispatch("core/editor"),{data:t}=u();return wp.element.useCallback(s=>r=>{const i={...t,[s]:r};e({[C]:i},{undoIgnore:!0}),j=i},[t,e])},u=()=>wp.data.useSelect(e=>{const{getEditedPostAttribute:t,isSavingPost:s,isPublishingPost:r,isEditedPostDirty:i}=e(wp.editor.store),o=t(C);return{data:o||j,isDirty:i(),isSaving:s()||r(),savedData:o}},[]);var x,f;const p=((f=(x=window.wptelegram)==null?void 0:x.uiData)==null?void 0:f.allChannels)||[],v=({isDisabled:e})=>{var c;const{data:t}=u(),s=w(),r=wp.element.useCallback(n=>()=>{var h,R;const g=((h=t.channels)==null?void 0:h.indexOf(n))!==-1?(R=t.channels)==null?void 0:R.filter(_=>_!==n):[...t.channels||[],n];s("channels")(g)},[t.channels,s]),i=p.every(n=>{var d;return((d=t.channels)==null?void 0:d.indexOf(n))!==-1}),o=!i&&p.some(n=>{var d;return((d=t.channels)==null?void 0:d.indexOf(n))!==-1}),m=p.length>5?`(${((c=t.channels)==null?void 0:c.length)||0}/${p.length})`:"",l=`${a("Send to")} ${m}`;return ReactJSXRuntime.jsx(wp.components.BaseControl,{id:"wptg-send-to",label:l,children:ReactJSXRuntime.jsxs("div",{role:"group",id:"wptg-send-to","aria-label":l,children:[ReactJSXRuntime.jsx(wp.components.CheckboxControl,{checked:i,disabled:e,indeterminate:o,onChange:n=>{const d=n?p:[];s("channels")(d)},label:a("Select all")}),p.map((n,d)=>{var g;return ReactJSXRuntime.jsx(wp.components.CheckboxControl,{label:n,disabled:e,checked:((g=t.channels)==null?void 0:g.indexOf(n))!==-1,onChange:r(n)},n+d)})]})})},k=({open:e})=>ReactJSXRuntime.jsx(wp.components.Button,{variant:"secondary",onClick:e,id:"wptg-upload-media",children:a("Add or Upload Files")}),D=[],F=({isDisabled:e})=>{const{data:t}=u(),s=w(),r=wp.element.useCallback(o=>()=>{const{[o]:m,...l}=t.files||{};s("files")(l)},[t.files,s]),i=wp.element.useCallback(o=>{const m=o.reduce((l,{id:c,url:n})=>(l[c]=n,l),{});s("files")(m)},[s]);return ReactJSXRuntime.jsx(wp.components.Disabled,{isDisabled:e,children:ReactJSXRuntime.jsxs(wp.components.BaseControl,{id:"wptg-files",label:a("Files"),help:a("Files to be sent after the message."),children:[ReactJSXRuntime.jsx("br",{}),ReactJSXRuntime.jsx(wp.mediaUtils.MediaUpload,{multiple:!0,onSelect:i,allowedTypes:D,render:k}),ReactJSXRuntime.jsx("ul",{role:"group",id:"wptg-files","aria-label":a("Files"),children:Object.entries(t.files||{}).map(([o,m],l)=>{const c=m.split("/"),n=c[c.length-1];return ReactJSXRuntime.jsx("li",{children:ReactJSXRuntime.jsxs(wp.components.Flex,{justify:"flex-start",children:[ReactJSXRuntime.jsx(wp.components.Button,{icon:ReactJSXRuntime.jsx(wp.components.Icon,{icon:"no-alt"}),onClick:r(o)}),ReactJSXRuntime.jsx("span",{children:n})]})},o+l)})})]})})},T=()=>ReactJSXRuntime.jsx(wp.components.SVG,{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"img","aria-hidden":"true",focusable:"false",children:ReactJSXRuntime.jsx(wp.components.Path,{fillRule:"evenodd",d:"M10.289 4.836A1 1 0 0111.275 4h1.306a1 1 0 01.987.836l.244 1.466c.787.26 1.503.679 2.108 1.218l1.393-.522a1 1 0 011.216.437l.653 1.13a1 1 0 01-.23 1.273l-1.148.944a6.025 6.025 0 010 2.435l1.149.946a1 1 0 01.23 1.272l-.653 1.13a1 1 0 01-1.216.437l-1.394-.522c-.605.54-1.32.958-2.108 1.218l-.244 1.466a1 1 0 01-.987.836h-1.306a1 1 0 01-.986-.836l-.244-1.466a5.995 5.995 0 01-2.108-1.218l-1.394.522a1 1 0 01-1.217-.436l-.653-1.131a1 1 0 01.23-1.272l1.149-.946a6.026 6.026 0 010-2.435l-1.148-.944a1 1 0 01-.23-1.272l.653-1.131a1 1 0 011.217-.437l1.393.522a5.994 5.994 0 012.108-1.218l.244-1.466zM14.929 12a3 3 0 11-6 0 3 3 0 016 0z"})}),P={width:"100%",maxWidth:"650px"},O={display:"flex",flexDirection:"column",justifyContent:"space-between"},B={width:"100%",justifyContent:"center",marginTop:"2em"},I={height:"1.5em"},M=()=>{const{data:e}=u(),t=w(),[s,r]=wp.element.useState(!1),i=wp.element.useCallback(()=>r(!0),[]),o=wp.element.useCallback(()=>r(!1),[]),m=wp.element.useCallback(c=>{var n;c!=null&&c.target&&"id"in c.target&&((n=c==null?void 0:c.target)==null?void 0:n.id)==="wptg-upload-media"||o()},[o]),l=ReactJSXRuntime.jsx("div",{style:I});return ReactJSXRuntime.jsxs(ReactJSXRuntime.Fragment,{children:[ReactJSXRuntime.jsx(wp.components.Button,{"aria-label":a("Override settings"),disabled:!e.send2tg,icon:ReactJSXRuntime.jsx(T,{}),size:"small",onClick:i}),s&&ReactJSXRuntime.jsx(wp.components.Modal,{isDismissible:!1,title:J("%s (%s)",a("Post to Telegram"),a("Override settings")),onRequestClose:m,style:P,children:ReactJSXRuntime.jsxs("div",{style:O,children:[ReactJSXRuntime.jsxs("div",{children:[ReactJSXRuntime.jsx(wp.components.ToggleControl,{label:a("Override settings"),checked:e.override_switch,onChange:t("override_switch")}),l,ReactJSXRuntime.jsx(v,{isDisabled:!e.override_switch}),l,ReactJSXRuntime.jsx(F,{isDisabled:!e.override_switch}),l,ReactJSXRuntime.jsx(wp.components.ToggleControl,{disabled:!e.override_switch,label:a("Disable Notifications"),checked:e.disable_notification,onChange:t("disable_notification")}),l,ReactJSXRuntime.jsx(wp.components.TextControl,{disabled:!e.override_switch,label:a("Delay in Posting"),value:e.delay||"0.5",onChange:t("delay"),step:"0.5",min:0,type:"number"}),l,ReactJSXRuntime.jsx(wp.components.ToggleControl,{disabled:!e.override_switch,label:a("Featured Image"),checked:e.send_featured_image,onChange:t("send_featured_image"),help:a("Send Featured Image (if exists).")}),l,ReactJSXRuntime.jsx(wp.components.TextareaControl,{disabled:!e.override_switch,label:a("Message Template"),value:e.message_template||"",onChange:t("message_template"),rows:10})]}),ReactJSXRuntime.jsx(wp.components.Button,{style:B,variant:"primary",onClick:o,children:a("Save Changes")})]})})]})},A={display:"flex",justifyContent:"space-between",alignItems:"flex-start",width:"100%",marginTop:"1rem"},E=()=>{const{data:e,savedData:t,isSaving:s,isDirty:r}=u(),i=w();return wp.element.useEffect(()=>{r&&!s&&!t&&i("send2tg")(e.send2tg)},[e.send2tg,r,s,t,i]),ReactJSXRuntime.jsx(wp.editPost.PluginPostStatusInfo,{children:ReactJSXRuntime.jsxs("div",{style:A,children:[ReactJSXRuntime.jsx(wp.components.ToggleControl,{label:a("Send to Telegram"),checked:e.send2tg,onChange:i("send2tg")}),ReactJSXRuntime.jsx(M,{})]})})};var b;const U=(b=window.wptelegram)==null?void 0:b.i18n;X(U,"wptelegram");wp.plugins.registerPlugin(y,{render:E});
//# sourceMappingURL=p2tg-block-editor-Ck7y-2EQ.js.map
