import{_ as o,j as e,a as $,s as G}from"./index-Cg7uBMVa.js";import"./_commonjsHelpers-CqkleIqs.js";var j,F;function L(){return F||(F=1,j=wp.plugins),j}var K=L(),C,k;function V(){return k||(k=1,C=wp.components),C}var n=V(),b,M;function W(){return M||(M=1,b=wp.editPost),b}var Y=W(),v,B;function J(){return B||(B=1,v=wp.editor),v}var R=J(),S,D;function Q(){return D||(D=1,S=wp.element),S}var _=Q(),y,T;function X(){return T||(T=1,y=wp.data),y}var U=X();const H="_wptg_p2tg_",Z="wptelegram-post-to-telegram";var E;let A={channels:[],delay:"0",disable_notification:!1,message_template:"",override_switch:!1,send2tg:!0,send_featured_image:!0,files:{},...(E=window.wptelegram)==null?void 0:E.savedSettings};const f=()=>{const{editPost:t}=U.useDispatch("core/editor"),{data:r}=m();return _.useCallback(c=>i=>{const l={...r,[c]:i};t({[H]:l},{undoIgnore:!0}),A=l},[r,t])},m=()=>U.useSelect(t=>{const{getEditedPostAttribute:r,isSavingPost:c,isPublishingPost:i,isEditedPostDirty:l}=t(R.store),u=r(H);return{data:u||A,isDirty:l(),isSaving:c()||i(),savedData:u}},[]);var N,I;const h=((I=(N=window.wptelegram)==null?void 0:N.uiData)==null?void 0:I.allChannels)||[],ee=()=>{var p;const{data:t}=m(),r=f(),c=_.useCallback(s=>()=>{var x,w;const g=((x=t.channels)==null?void 0:x.indexOf(s))!==-1?(w=t.channels)==null?void 0:w.filter(z=>z!==s):[...t.channels||[],s];r("channels")(g)},[t.channels,r]),i=h.every(s=>{var a;return((a=t.channels)==null?void 0:a.indexOf(s))!==-1}),l=!i&&h.some(s=>{var a;return((a=t.channels)==null?void 0:a.indexOf(s))!==-1}),u=h.length>5?`(${((p=t.channels)==null?void 0:p.length)||0}/${h.length})`:"",d=`${o("Send to")} ${u}`;return e.jsx(n.BaseControl,{id:"wptg-send-to",label:d,__nextHasNoMarginBottom:!0,children:e.jsxs(n.Flex,{role:"group",direction:"column",id:"wptg-send-to","aria-label":d,as:"fieldset",children:[e.jsx(n.CheckboxControl,{checked:i,indeterminate:l,onChange:s=>{const a=s?h:[];r("channels")(a)},label:o("Select all"),__nextHasNoMarginBottom:!0}),h.map((s,a)=>{var g;return e.jsx(n.CheckboxControl,{label:s,checked:((g=t.channels)==null?void 0:g.indexOf(s))!==-1,onChange:c(s),__nextHasNoMarginBottom:!0},s+a)})]})})};var P,q;function te(){return q||(q=1,P=wp.mediaUtils),P}var se=te();const ne=({open:t})=>e.jsx(n.Button,{variant:"secondary",onClick:t,id:"wptg-upload-media",children:o("Add or Upload Files")}),re=[];function ae(){const{data:t}=m(),r=f(),c=_.useCallback(d=>()=>{const{[d]:p,...s}=t.files||{};r("files")(s)},[t.files,r]),[i,l]=_.useState({}),u=_.useCallback(d=>{const p=d.reduce((s,{id:a,url:g,filesizeHumanReadable:x})=>(x&&l(w=>({...w,[a]:x})),s[a]=g,s),{});r("files")(p)},[r]);return e.jsxs(n.BaseControl,{id:"wptg-files",label:o("Files"),help:o("Files to be sent after the message."),__nextHasNoMarginBottom:!0,children:[e.jsx(se.MediaUpload,{multiple:!0,onSelect:u,allowedTypes:re,render:ne}),e.jsx("fieldset",{children:e.jsx("ul",{id:"wptg-files","aria-label":o("Files"),children:Object.entries(t.files||{}).map(([d,p],s)=>{const a=p.split("/"),g=a[a.length-1];return e.jsx("li",{children:e.jsxs(n.Flex,{justify:"flex-start",children:[e.jsx(n.Button,{icon:e.jsx(n.Icon,{icon:"no-alt"}),onClick:c(d)}),e.jsx("span",{children:g}),i[d]?e.jsxs("span",{children:["(",i[d],")"]}):null]})},d+s)})})})]})}const oe=()=>e.jsx(n.SVG,{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"img","aria-hidden":"true",focusable:"false",children:e.jsx(n.Path,{fillRule:"evenodd",d:"M10.289 4.836A1 1 0 0111.275 4h1.306a1 1 0 01.987.836l.244 1.466c.787.26 1.503.679 2.108 1.218l1.393-.522a1 1 0 011.216.437l.653 1.13a1 1 0 01-.23 1.273l-1.148.944a6.025 6.025 0 010 2.435l1.149.946a1 1 0 01.23 1.272l-.653 1.13a1 1 0 01-1.216.437l-1.394-.522c-.605.54-1.32.958-2.108 1.218l-.244 1.466a1 1 0 01-.987.836h-1.306a1 1 0 01-.986-.836l-.244-1.466a5.995 5.995 0 01-2.108-1.218l-1.394.522a1 1 0 01-1.217-.436l-.653-1.131a1 1 0 01.23-1.272l1.149-.946a6.026 6.026 0 010-2.435l-1.148-.944a1 1 0 01-.23-1.272l.653-1.131a1 1 0 011.217-.437l1.393.522a5.994 5.994 0 012.108-1.218l.244-1.466zM14.929 12a3 3 0 11-6 0 3 3 0 016 0z"})}),ie={width:"100%",maxWidth:"650px"},le={width:"100%",justifyContent:"center",marginTop:"2em"},de=()=>{const{data:t}=m(),r=f(),[c,i]=_.useState(!1),l=_.useCallback(()=>i(!0),[]),u=_.useCallback(()=>i(!1),[]),d=_.useCallback(s=>{var a;s!=null&&s.target&&"id"in s.target&&((a=s==null?void 0:s.target)==null?void 0:a.id)==="wptg-upload-media"||u()},[u]),p=!t.override_switch;return e.jsxs(e.Fragment,{children:[e.jsx(n.Button,{"aria-label":o("Override settings"),disabled:!t.send2tg,icon:e.jsx(oe,{}),size:"small",onClick:l}),c&&e.jsx(n.Modal,{title:$.sprintf("%s (%s)",o("Post to Telegram"),o("Override settings")),onRequestClose:d,style:ie,children:e.jsxs(n.Flex,{direction:"column",children:[e.jsxs(n.Flex,{direction:"column",gap:8,children:[e.jsx(n.ToggleControl,{label:o("Override settings"),checked:t.override_switch,onChange:r("override_switch"),__nextHasNoMarginBottom:!0}),e.jsx(n.Disabled,{isDisabled:p,style:{opacity:p?.3:1},children:e.jsxs(n.Flex,{direction:"column",gap:6,children:[e.jsx(ee,{}),e.jsx(ae,{}),e.jsx(n.ToggleControl,{label:o("Disable Notifications"),checked:t.disable_notification,onChange:r("disable_notification"),__nextHasNoMarginBottom:!0}),e.jsx(n.TextControl,{label:o("Delay in Posting"),value:t.delay||"0.5",onChange:r("delay"),step:"0.5",min:0,type:"number",__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),e.jsx(n.ToggleControl,{label:o("Featured Image"),checked:t.send_featured_image,onChange:r("send_featured_image"),help:o("Send Featured Image (if exists)."),__nextHasNoMarginBottom:!0}),e.jsx(n.TextareaControl,{label:o("Message Template"),value:t.message_template||"",onChange:r("message_template"),rows:10,__nextHasNoMarginBottom:!0})]})})]}),e.jsx(n.Button,{style:le,variant:"primary",onClick:u,children:o("Save Changes")})]})})]})},ce={display:"flex",justifyContent:"space-between",alignItems:"flex-start",width:"100%",marginTop:"1rem"},ue=R.PluginPostStatusInfo||Y.PluginPostStatusInfo,pe=()=>{const{data:t,savedData:r,isSaving:c,isDirty:i}=m(),l=f();return _.useEffect(()=>{i&&!c&&!r&&l("send2tg")(t.send2tg)},[t.send2tg,i,c,r,l]),e.jsx(ue,{children:e.jsxs("div",{style:ce,children:[e.jsx(n.ToggleControl,{label:o("Send to Telegram"),checked:t.send2tg,onChange:l("send2tg"),__nextHasNoMarginBottom:!0}),e.jsx(de,{})]})})};var O;const _e=(O=window.wptelegram)==null?void 0:O.i18n;G(_e,"wptelegram");K.registerPlugin(Z,{render:pe});
//# sourceMappingURL=p2tg-block-editor-Blrilko_.js.map
